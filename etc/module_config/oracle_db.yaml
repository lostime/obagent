obInputBasic: &obInputBasic
  plugin: oracleTableInput
  config:
    timeout: 10s
    pluginConfig:
      maintainCacheThreads: 4
      connection:
        url: ${monagent.ob.oracle.user}/${monagent.ob.oracle.password}@127.1:${monagent.ob.sql.port}/${monagent.ob.oracle.server.name}
        maxIdle: 2
        maxOpen: 32
      defaultConditionValues:
        ob_svr_ip: ${monagent.host.ip}
        ob_svr_port: ${monagent.ob.rpc.port}
        ob_is_rootservice: true
      collectConfig:
        - sql: select /*+ MONITOR_AGENT READ_CONSISTENCY(WEAK) */ id, name1, name2, name3, cnt from test_table2
          name: oracle_db
          tags:
            id: id
            name1: name1
            name2: name2
            name3: name3
          metrics:
            value: cnt

retagProcessor: &retagProcessor
  plugin: retagProcessor
  config:
    timout: 10s
    pluginConfig:
      newTags:
        app: OB
        obzone: ${monagent.ob.zone.name}
        svr_ip: ${monagent.host.ip}
        ob_cluster_id: ${monagent.ob.cluster.id}
        ob_cluster_name: ${monagent.ob.cluster.name}

prometheusExporter: &prometheusExporter
  plugin: prometheusExporter
  config:
    timout: 10s
    pluginConfig:
      formatType: fmtText

modules:
  - module: monitor.ob.oracle
    moduleType: monagent.pipeline
    process: monagent
    config:
      name: monitor.ob.oracle
      status: active
      pipelines:
        - name: ob_oracle
          config:
            scheduleStrategy: trigger
            exposeUrl: /metrics/ob/oracle
          structure:
            inputs:
              - <<: *obInputBasic
            processors:
              - <<: *retagProcessor
            exporter:
              <<: *prometheusExporter